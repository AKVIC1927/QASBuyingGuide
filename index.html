<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Price Calculator and KM to Miles Converter</title>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f5f5f5;
            box-sizing: border-box;
        }

        .navbar {
            width: 100%;
            max-width: 650px;
            border-radius: 8px;
            top: 10px;
            background-color: #2461a4;
            overflow: hidden;
            position: fixed;
            z-index: 1000;
            display: flex;
            justify-content: center;
        }

        .navbar a {
            color: white;
            padding: 14px 20px;
            text-align: center;
            text-decoration: none;
            display: block;
        }

        .navbar a:hover {
            background-color: #ddd;
            color: black;
        }

        .content {
            margin-top: 60px; /* Adjust margin to prevent content overlap with navbar */
            width: 100%;
            max-width: 800px;
        }

        .headerguide {
            width: 100%;
            max-width: 400px;
            background-color: #2461a4;
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: fixed;
            border-radius: 8px;
            top: 10px;
            z-index: 1000;
        }

        .headerguide img {
            height: 40px;
            max-width: 100%;
        }

        .container, .converter-container, .car-calculator-container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
            width: 70%;
            max-width: 800px;
            box-sizing: border-box;
            justify-content: space-around;
            display: none; /* Initially hidden */
        }

        .form-container, .car-calculator-form-container {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
            width: 100%;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 1rem; /* Responsive font size */
        }

        .form-group .input-container {
            position: relative;
            width: 100%;
        }

        .form-group input[type="text"],
        .form-group input[type="number"] {
            width: calc(100% - 20px);
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            display: inline-block;
            -webkit-appearance: none; /* Override default appearance */
            appearance: none;
            box-sizing: border-box;
            font-size: 1rem; /* Responsive font size */
        }

        .form-group input[readonly] {
            background-color: #f5f5f5;
        }

        .spinner-button {
            position: absolute;
            right: 0;
            width: 20px;
            height: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            user-select: none;
        }

        .spinner-up {
            top: 0;
            background-color: #4caf82;
            border-radius: 0 4px 0 0;
        }

        .spinner-down {
            bottom: 0;
            background-color: #af514c;
            border-radius: 0 0 4px 0;
        }

        .actions {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }

        .actions button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-size: 1rem;
        }

        .actions button:hover {
            background-color: #ddd;
        }

        .actions .save-btn {
            background-color: #4caf50;
            color: white;
        }

        .actions .cancel-btn {
            background-color: #f44336;
            color: white;
        }

        .last-entries {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 800px;
            margin-top: 20px;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
        }

        .last-entries table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .last-entries table, .last-entries th, .last-entries td {
            border: 1px solid #ddd;
        }

        .last-entries th, .last-entries td {
            padding: 10px;
            text-align: left;
            font-size: 0.9rem;
        }

        .converter-container {
            color: white;
            background-color: #4fa75c;
            padding: 20px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            margin-top: 20px;
            position: fixed;
        }

        .converter-container label {
            display: block;
            margin-bottom: 5px;
            font-size: 1rem; /* Responsive font size */
        }

        .converter-container .input-container {
            position: relative;
            width: 100%;
        }

        .converter-container input[type="text"],
        .converter-container input[type="number"] {
            background-color: #2160a1;
            font: inherit;
            color: white;
            width: calc(100% - 20px);
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            display: inline-block;
            -webkit-appearance: none; /* Override default appearance */
            appearance: none;
            box-sizing: border-box;
            font-size: 1rem; /* Responsive font size */
        }

        .car-calculator-container {
            background-color: #4fa75c;
            padding: 20px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            margin-top: 20px;
        }

        .car-calculator-container label {
            display: block;
            margin-bottom: 5px;
            font-size: 1rem; /* Responsive font size */
        }

        .car-calculator-container .input-container {
            position: relative;
            width: 100%;
        }

        .car-calculator-container input[type="text"],
        .car-calculator-container input[type="number"] {
            background-color: #2160a1;
            font: inherit;
            color: white;
            width: calc(100% - 20px);
            padding: 10px;
            border: 1px solid #ffffff;
            border-radius: 4px;
            display: inline-block;
            -webkit-appearance: none; /* Override default appearance */
            appearance: none;
            box-sizing: border-box;
            font-size: 1rem; /* Responsive font size */
        }

        ::placeholder {
            text-transform: none;
            color: rgb(209, 209, 209);
        }

        .converter-container .spinner-button,
        .car-calculator-container .spinner-button {
            position: absolute;
            right: 0;
            width: 20px;
            height: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            user-select: none;
        }

        .converter-container .spinner-up,
        .car-calculator-container .spinner-up {
            top: 0;
            background-color: #4caf82;
            border-radius: 0 4px 0 0;
        }

        .converter-container .spinner-down,
        .car-calculator-container .spinner-down {
            bottom: 0;
            background-color: #af514c;
            border-radius: 0 0 4px 0;
        }

        @media (min-width: 768px) {
            .container {
                flex-direction: row;
                justify-content: space-around;
            }
            .form-container {
                margin-right: 20px;
                width: 55%;
            }
            .converter-container,
            .car-calculator-container {
                width: 40%;
            }
        }
    </style>
</head>
<body>
    <div class="navbar">
        <a href="#" onclick="showPage('calculator')">Price Calculator</a>
        <a href="#" onclick="showPage('converter')">KM to Miles Converter</a>
        <a href="#" onclick="showPage('carCalculator')">Car Buying Calculator</a>
    </div>

    <div class="content">
        <!-- Price Calculator Page -->
        <div class="container" id="calculator">
            <div class="form-container">
                <div class="form-group">
                    <label for="vin">VIN</label>
                    <input type="text" id="vin" maxlength="7" placeholder="To Save Enter Last 6" oninput="formatVin()" inputmode="numeric" pattern="[0-9]*" onkeypress="return isNumberKey(event)"
                    style="text-transform:uppercase">
                </div>
                <div class="form-group">
                    <label for="usdPrice">USD PRICE</label>
                    <div class="input-container">
                        <input type="text" id="usdPrice" value="$ 0" inputmode="numeric" oninput="formatAndCalculate('usdPrice')" onkeypress="return isNumberKey(event)">
                        <div class="spinner-button spinner-up" onclick="incrementInput('usdPrice', 100)">▲</div>
                        <div class="spinner-button spinner-down" onclick="incrementInput('usdPrice', -100)">▼</div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="exchangeRate">Exchange Rate</label>
                    <div class="input-container">
                        <input type="number" id="exchangeRate" step="0.01" value="1.36" inputmode="numeric" oninput="calculateCadPrice()" onkeypress="return isNumberKey(event)">
                        <div class="spinner-button spinner-up" onclick="incrementInput('exchangeRate', 0.01)">▲</div>
                        <div class="spinner-button spinner-down" onclick="incrementInput('exchangeRate', -0.01)">▼</div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="expenses">Expenses</label>
                    <div class="input-container">
                        <input type="text" id="expenses" value="$ 6 000" inputmode="numeric" oninput="formatAndCalculate('expenses')" onkeypress="return isNumberKey(event)">
                        <div class="spinner-button spinner-up" onclick="incrementInput('expenses', 250)">▲</div>
                        <div class="spinner-button spinner-down" onclick="incrementInput('expenses', -250)">▼</div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="profit">Profit</label>
                    <div class="input-container">
                        <input type="text" id="profit" value="$ 0" inputmode="numeric" oninput="formatAndCalculate('profit')" onkeypress="return isNumberKey(event)">
                        <div class="spinner-button spinner-up" onclick="incrementInput('profit', 250)">▲</div>
                        <div class="spinner-button spinner-down" onclick="incrementInput('profit', -250)">▼</div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="cadPrice">CAD PRICE</label>
                    <input type="text" id="cadPrice" readonly>
                </div>
                <div class="actions">
                    <button class="cancel-btn" onclick="resetForm()">Reset</button>
                    <button class="save-btn" onclick="saveEntry()">Save</button>
                </div>
            </div>
        </div>

        <!-- KM to Miles Converter Page -->
        <div class="converter-container" id="converter">
            <label for="kmInput">KM to Miles</label>
            <div class="input-container">
                <input type="text" id="kmInput" placeholder="0" inputmode="numeric" oninput="convertKmToMiles()" onkeypress="return isNumberKey(event)">
                <div class="spinner-button spinner-up" onclick="incrementKm(10)">▲</div>
                <div class="spinner-button spinner-down" onclick="incrementKm(-10)">▼</div>
            </div>
            <p id="milesOutput">Miles: 0</p>
        </div>

        <!-- Car Buying Calculator Page -->
        <div class="car-calculator-container" id="carCalculator">
            <div class="car-calculator-form-container">
                <div class="form-group">
                    <label for="cadBoughtPrice">CAD Bought Price</label>
                    <div class="input-container">
                        <input type="text" id="cadBoughtPrice" value="$ 0" inputmode="numeric" oninput="formatAndCalculateCar('cadBoughtPrice')" onkeypress="return isNumberKey(event)">
                        <div class="spinner-button spinner-up" onclick="incrementCarInput('cadBoughtPrice', 100)">▲</div>
                        <div class="spinner-button spinner-down" onclick="incrementCarInput('cadBoughtPrice', -100)">▼</div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="desiredProfit">Desired Profit</label>
                    <div class="input-container">
                        <input type="text" id="desiredProfit" value="$ 0" inputmode="numeric" oninput="formatAndCalculateCar('desiredProfit')" onkeypress="return isNumberKey(event)">
                        <div class="spinner-button spinner-up" onclick="incrementCarInput('desiredProfit', 100)">▲</div>
                        <div class="spinner-button spinner-down" onclick="incrementCarInput('desiredProfit', -100)">▼</div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="fxRate">FX Rate (CAD to USD)</label>
                    <div class="input-container">
                        <input type="number" id="fxRate" step="0.01" value="1.36" inputmode="numeric" oninput="calculateUsdSellingPrice()" onkeypress="return isNumberKey(event)">
                        <div class="spinner-button spinner-up" onclick="incrementCarInput('fxRate', 0.01)">▲</div>
                        <div class="spinner-button spinner-down" onclick="incrementCarInput('fxRate', -0.01)">▼</div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="usdSellingPrice">USD Selling Price</label>
                    <input type="text" id="usdSellingPrice" readonly>
                </div>
                <div class="actions">
                    <button class="cancel-btn" onclick="resetCarForm()">Reset</button>
                </div>
            </div>
        </div>
    </div>

    <div class="last-entries">
        <h3>Last 6 Entries</h3>
        <table id="entriesTable" style="text-transform:uppercase">
            <svg style="height: 40px; cursor:pointer;" onclick="copyTableToClipboard()" fill="#2461a4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52.00 52.00" enable-background="new 0 0 52 52" xml:space="preserve" stroke="#2461a4" stroke-width="0.0005200000000000001" transform="matrix(-1, 0, 0, 1, 0, 0)rotate(0)"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" stroke="#55a461" stroke-width="2.08"> <g> <path d="M17.4,11.6h17.3c0.9,0,1.6-0.7,1.6-1.6V6.8c0-2.6-2.1-4.8-4.7-4.8h-11c-2.6,0-4.7,2.2-4.7,4.8V10 C15.8,10.9,16.5,11.6,17.4,11.6z"></path> <path d="M43.3,6h-1.6c-0.5,0-0.8,0.3-0.8,0.8V10c0,3.5-2.8,6.4-6.3,6.4H17.4c-3.5,0-6.3-2.9-6.3-6.4V6.8 c0-0.5-0.3-0.8-0.8-0.8H8.7C6.1,6,4,8.2,4,10.8v34.4C4,47.8,6.1,50,8.7,50h34.6c2.6,0,4.7-2.2,4.7-4.8V10.8C48,8.2,45.9,6,43.3,6z"></path> </g> </g><g id="SVGRepo_iconCarrier"> <g> <path d="M17.4,11.6h17.3c0.9,0,1.6-0.7,1.6-1.6V6.8c0-2.6-2.1-4.8-4.7-4.8h-11c-2.6,0-4.7,2.2-4.7,4.8V10 C15.8,10.9,16.5,11.6,17.4,11.6z"></path> <path d="M43.3,6h-1.6c-0.5,0-0.8,0.3-0.8,0.8V10c0,3.5-2.8,6.4-6.3,6.4H17.4c-3.5,0-6.3-2.9-6.3-6.4V6.8 c0-0.5-0.3-0.8-0.8-0.8H8.7C6.1,6,4,8.2,4,10.8v34.4C4,47.8,6.1,50,8.7,50h34.6c2.6,0,4.7-2.2,4.7-4.8V10.8C48,8.2,45.9,6,43.3,6z"></path> </g> </g></svg>
            <thead>
                <tr>
                    <th>Last 6 VIN</th>
                    <th>USD PRICE</th>
                    <th>CAD PRICE</th>
                </tr>
            </thead>
            <tbody>
                
            </tbody>
        </table>
    </div>

    <script>
        function showPage(page) {
            document.querySelectorAll('.container, .converter-container, .car-calculator-container').forEach(container => {
                container.style.display = 'none';
            });
            document.getElementById(page).style.display = 'flex';
        }

        function formatNumber(num) {
            return "$ " + num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
        }

        function formatNumberNoSymbol(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
        }

        function parseFormattedNumber(str) {
            return parseFloat(str.replace(/[^0-9.-]+/g,""));
        }

        function formatAndCalculate(id) {
            let input = document.getElementById(id);
            let value = parseFormattedNumber(input.value);
            input.value = formatNumber(value);
            calculateCadPrice();
        }

        function formatAndCalculateCar(id) {
            let input = document.getElementById(id);
            let value = parseFormattedNumber(input.value);
            input.value = formatNumber(value);
            calculateUsdSellingPrice();
        }

        function calculateCadPrice() {
            const usdPrice = parseFormattedNumber(document.getElementById('usdPrice').value) || 0;
            const exchangeRate = parseFloat(document.getElementById('exchangeRate').value) || 0;
            const expenses = parseFormattedNumber(document.getElementById('expenses').value) || 0;
            const profit = parseFormattedNumber(document.getElementById('profit').value) || 0;
            const cadPrice = Math.ceil((usdPrice * exchangeRate) - (expenses + profit));
            document.getElementById('cadPrice').value = formatNumber(cadPrice);
        }

        function calculateUsdSellingPrice() {
            const cadBoughtPrice = parseFormattedNumber(document.getElementById('cadBoughtPrice').value) || 0;
            const desiredProfit = parseFormattedNumber(document.getElementById('desiredProfit').value) || 0;
            const fxRate = parseFloat(document.getElementById('fxRate').value) || 0;
            const usdSellingPrice = Math.ceil((cadBoughtPrice + desiredProfit) / fxRate);
            document.getElementById('usdSellingPrice').value = formatNumber(usdSellingPrice);
        }

        function incrementInput(id, increment) {
            let input = document.getElementById(id);
            let value;
            if (input.type === 'text') {
                value = parseFormattedNumber(input.value) || 0;
            } else {
                value = parseFloat(input.value) || 0;
            }
            value += increment;
            if (input.type === 'text') {
                input.value = formatNumber(value);
            } else {
                input.value = value.toFixed(2);
            }
            calculateCadPrice();
        }

        function incrementCarInput(id, increment) {
            let input = document.getElementById(id);
            let value;
            if (input.type === 'text') {
                value = parseFormattedNumber(input.value) || 0;
            } else {
                value = parseFloat(input.value) || 0;
            }
            value += increment;
            if (input.type === 'text') {
                input.value = formatNumber(value);
            } else {
                input.value = value.toFixed(2);
            }
            calculateUsdSellingPrice();
        }

        function resetForm() {
            document.getElementById('vin').value = '';
            document.getElementById('usdPrice').value = '$ 0';
            document.getElementById('exchangeRate').value = '1.36';
            document.getElementById('expenses').value = '$ 6 000';
            document.getElementById('profit').value = '$ 0';
            document.getElementById('cadPrice').value = '';
        }

        function resetCarForm() {
            document.getElementById('cadBoughtPrice').value = '$ 0';
            document.getElementById('desiredProfit').value = '$ 0';
            document.getElementById('fxRate').value = '1.36';
            document.getElementById('usdSellingPrice').value = '';
        }

        function saveEntry() {
            const vin = document.getElementById('vin').value;
            const usdPrice = document.getElementById('usdPrice').value;
            const cadPrice = document.getElementById('cadPrice').value;

            if (vin.length < 6) {
                alert('VIN must be at least 6 characters long.');
                return;
            }

            const last6Vin = vin.slice(-7);

            const table = document.getElementById('entriesTable').getElementsByTagName('tbody')[0];
            const newRow = table.insertRow(0);  // Insert new row at the top

            const cell1 = newRow.insertCell(0);
            const cell2 = newRow.insertCell(1);
            const cell3 = newRow.insertCell(2);

            cell1.innerHTML = last6Vin;
            cell2.innerHTML = usdPrice;
            cell3.innerHTML = cadPrice;

            if (table.rows.length > 6) {
                table.deleteRow(6);
            }
        }

        function convertKmToMiles() {
            const kmInput = document.getElementById('kmInput');
            let km = kmInput.value.replace(/\s+/g, '');
            if (km === '') return;
            km = parseInt(km.replace(/[^0-9]/g, ''), 10);
            if (km > 999999) {
                km = 999999;
            }
            kmInput.value = formatNumberNoSymbol(km);
            const miles = km * 0.621371;
            document.getElementById('milesOutput').innerText = "Miles: " + formatNumberNoSymbol(miles.toFixed(0));
        }

        function incrementKm(amount) {
            const kmInput = document.getElementById('kmInput');
            let km = kmInput.value.replace(/\s+/g, '');
            km = parseInt(km.replace(/[^0-9]/g, ''), 10) || 0;
            km += amount;
            if (km > 999999) {
                km = 999999;
            } else if (km < 0) {
                km = 0;
            }
            kmInput.value = formatNumberNoSymbol(km);
            convertKmToMiles();
        }

        function formatVin() {
            const vinInput = document.getElementById('vin');
            let vinValue = vinInput.value.replace(/\s+/g, ''); // Remove all spaces
            if (vinValue.length > 3) {
                vinValue = vinValue.slice(0, 3) + ' ' + vinValue.slice(3); // Add space after 3 characters
            }
            vinInput.value = vinValue;
        }

        function isNumberKey(evt) {
            var charCode = (evt.which) ? evt.which : evt.keyCode;
            if (charCode > 31 && (charCode < 48 || charCode > 57)) {
                return false;
            }
            return true;
        }

        function copyTableToClipboard() {
            let table = document.querySelector('.last-entries table');
            let range = document.createRange();
            range.selectNode(table);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            document.execCommand('copy');
            window.getSelection().removeAllRanges();
            alert('Table copied to clipboard');
        }

        // Initial setup
        calculateCadPrice();
        showPage('calculator'); // Default page to show
    </script>
</body>
</html>
